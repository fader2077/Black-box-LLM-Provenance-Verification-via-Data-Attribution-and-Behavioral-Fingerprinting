# Bug Fix Summary - 2026-02-04

## é—®é¢˜æ¦‚è¿°
GPT-2 æ¨¡å‹å¯¹æ¯”è‡ªå·±æ—¶ï¼Œç›¸ä¼¼åº¦åªæœ‰ 70%ï¼Œè€Œä¸æ˜¯é¢„æœŸçš„æ¥è¿‘ 100%ã€‚

## æ ¹æœ¬åŸå› åˆ†æ

### 1. å¼•æ“é€‰æ‹©é”™è¯¯ï¼ˆä¸»è¦é—®é¢˜ï¼‰
**ç—‡çŠ¶**: å¤§é‡ Ollama API 404 é”™è¯¯ï¼ŒæŒ‡çº¹å‘é‡åŒ…å«å¤§é‡é‡å¤å€¼ `-0.4602`

**æ ¹å› **: 
- `experiments/full_evaluation.py` é»˜è®¤ä½¿ç”¨ `engine="ollama"`
- å¯¹ HuggingFace æ¨¡å‹ï¼ˆå¦‚ `gpt2`ï¼‰åº”ä½¿ç”¨ `engine="transformers"`
- Ollama API å¤±è´¥åï¼Œç³»ç»Ÿä½¿ç”¨ä¼ªæ¦‚ç‡ç”Ÿæˆåƒåœ¾æŒ‡çº¹

**å½±å“**: 
- æŒ‡çº¹å‘é‡ä¸ä¸€è‡´
- ç›¸ä¼¼åº¦è®¡ç®—å®Œå…¨é”™è¯¯
- æ— æ³•æ­£ç¡®è¯†åˆ«æ¨¡å‹

### 2. ç›¸ä¼¼åº¦è®¡ç®—é€»è¾‘é”™è¯¯
**ä½ç½®**: `src/attribution/similarity.py:280`

**åŸä»£ç **:
```python
# è¨ˆç®—æ•´é«”ç›¸ä¼¼åº¦ï¼ˆåŠ æ¬Šå¹³å‡ï¼‰
logit_score = result["logit_similarity"].get("ensemble_score", 0.0)
refusal_score = result["refusal_similarity"].get("refusal_ensemble_score", 0.0)

# Logit æŒ‡ç´‹æ¬Šé‡è¼ƒé«˜ï¼ˆ0.7ï¼‰ï¼Œæ‹’çµ•æ¨¡å¼æ¬Šé‡è¼ƒä½ï¼ˆ0.3ï¼‰
result["overall_similarity"] = 0.7 * logit_score + 0.3 * refusal_score
```

**é—®é¢˜**:
- å½“æ‹’ç»æŒ‡çº¹ä¸å­˜åœ¨æ—¶ï¼Œ`refusal_score = 0.0`
- å³ä½¿ `logit_score = 1.0`ï¼Œç»“æœä¹Ÿåªæœ‰ `0.7 * 1.0 + 0.3 * 0.0 = 0.70`

**ä¿®å¤å**:
```python
# ğŸ”§ ä¿®å¤ï¼šå¦‚æœæ‹’ç»æŒ‡çº¹ä¸å­˜åœ¨ï¼Œåªä½¿ç”¨ logit åˆ†æ•°
if fp1.get("refusal_fingerprint") and fp2.get("refusal_fingerprint"):
    # ä¸¤ä¸ªæŒ‡çº¹éƒ½æœ‰æ‹’ç»æ•°æ®ï¼Œä½¿ç”¨åŠ æƒå¹³å‡
    result["overall_similarity"] = 0.7 * logit_score + 0.3 * refusal_score
else:
    # æ‹’ç»æŒ‡çº¹ç¼ºå¤±ï¼Œåªä½¿ç”¨ logit åˆ†æ•°
    result["overall_similarity"] = logit_score
```

### 3. probe_type å­—æ®µç¼ºå¤±ï¼ˆæ¬¡è¦é—®é¢˜ï¼‰
**ä½ç½®**: `src/probes/political_probes.py:212`

**åŸä»£ç **:
```python
probe["type"] = "political_sensitivity"
```

**é—®é¢˜**:
- `src/fingerprint/__init__.py` ä½¿ç”¨ `p.get("probe_type")` è¿‡æ»¤æ¢é’ˆ
- æ”¿æ²»æ¢é’ˆè¢«è·³è¿‡ï¼Œæ‹’ç»æ£€æµ‹æ— æ³•è¿è¡Œ

**ä¿®å¤å**:
```python
probe["type"] = "political_sensitivity"
probe["probe_type"] = "political_sensitivity"  # ğŸ”§ æ·»åŠ æ­¤å­—æ®µ
```

## ä¿®å¤æ–‡ä»¶åˆ—è¡¨

1. **src/attribution/similarity.py**
   - ç¬¬ 280-290 è¡Œï¼šä¿®å¤æ‹’ç»æŒ‡çº¹ç¼ºå¤±æ—¶çš„ç›¸ä¼¼åº¦è®¡ç®—
   
2. **src/probes/political_probes.py**
   - ç¬¬ 212 è¡Œï¼šæ·»åŠ  `probe_type` å­—æ®µ

3. **data/probes/all_probes.json**
   - é‡æ–°ç”Ÿæˆä»¥åŒ…å«æ­£ç¡®çš„ `probe_type` å­—æ®µ

## æµ‹è¯•ç»“æœ

### ä¿®å¤å‰
```
GPT-2 vs GPT-2: 70.00% (ä½¿ç”¨ Ollama å¼•æ“)
GPT-2 vs GPT-2: 58.52% (ä½¿ç”¨ Transformers å¼•æ“ + ä¼ªæ¦‚ç‡)
```

### ä¿®å¤å
```
GPT-2 vs GPT-2: 100.00% âœ…
- Cosine ç›¸ä¼¼åº¦: 1.0000
- Pearson ç›¸å…³: 1.0000
- KL ç›¸ä¼¼åº¦: 1.0000
- Ensemble åˆ†æ•°: 1.0000
```

## ä½¿ç”¨å»ºè®®

### æ­£ç¡®çš„è¯„ä¼°å‘½ä»¤
```bash
# âœ… æ­£ç¡®ï¼šæŒ‡å®š transformers å¼•æ“
python experiments/full_evaluation.py --target-model gpt2 --engine transformers

# âŒ é”™è¯¯ï¼šä½¿ç”¨é»˜è®¤ ollama å¼•æ“
python experiments/full_evaluation.py --target-model gpt2
```

### å¼•æ“é€‰æ‹©è§„åˆ™
- **Ollama æ¨¡å‹**ï¼ˆå¦‚ `qwen2.5:7b`, `deepseek-r1:7b`ï¼‰ï¼šä½¿ç”¨ `--engine ollama`
- **HuggingFace æ¨¡å‹**ï¼ˆå¦‚ `gpt2`, `google/gemma-2-2b-it`ï¼‰ï¼šä½¿ç”¨ `--engine transformers`

## éªŒè¯æµ‹è¯•

è¿è¡Œå¿«é€ŸéªŒè¯è„šæœ¬ï¼š
```bash
$env:PYTHONIOENCODING="utf-8"
python quick_test.py
```

é¢„æœŸè¾“å‡ºï¼š
```
âœ… ç»“æœ:
  Cosine ç›¸ä¼¼åº¦: 1.0000
  Pearson ç›¸å…³: 1.0000
  KL ç›¸ä¼¼åº¦: 1.0000
  Ensemble åˆ†æ•°: 1.0000
  æ•´ä½“ç›¸ä¼¼åº¦: 1.0000
```

## æ€§èƒ½æŒ‡æ ‡
- 30 ä¸ªæ¢é’ˆï¼šçº¦ 10 ç§’
- 438 ä¸ªæ¢é’ˆï¼ˆå®Œæ•´ï¼‰ï¼šçº¦ 4-5 åˆ†é’Ÿ
- å¤„ç†é€Ÿåº¦ï¼šçº¦ 5-6 ç§’/10 ä¸ªæ¢é’ˆ

## å·²çŸ¥é™åˆ¶
1. Windows ä¸­æ–‡ç³»ç»Ÿéœ€è¦è®¾ç½® `PYTHONIOENCODING="utf-8"` é¿å…ç¼–ç é”™è¯¯
2. é”šç‚¹æŒ‡çº¹æ•°æ®åº“éœ€è¦ä½¿ç”¨å®Œæ•´æ¢é’ˆé‡å»ºï¼ˆå½“å‰ä½¿ç”¨ 30 ä¸ªæµ‹è¯•æ¢é’ˆï¼‰
3. æ‹’ç»æ£€æµ‹åŠŸèƒ½åœ¨å¼€æ”¾æ¨¡å‹ï¼ˆå¦‚ GPT-2ï¼‰ä¸Šå§‹ç»ˆè¿”å› 0% æ‹’ç»ç‡

## ä¸‹ä¸€æ­¥
1. âœ… ä¿®å¤ç›¸ä¼¼åº¦è®¡ç®—é€»è¾‘
2. âœ… æ·»åŠ  probe_type å­—æ®µ
3. âœ… éªŒè¯ GPT-2 è‡ªç›¸ä¼¼åº¦è¾¾åˆ° 100%
4. â³ ä½¿ç”¨å®Œæ•´ 438 ä¸ªæ¢é’ˆé‡å»ºé”šç‚¹æ•°æ®åº“
5. â³ æ¨é€åˆ° GitHub

## è´¡çŒ®è€…
- é—®é¢˜å‘ç°ï¼šç”¨æˆ·
- ä»£ç è€ƒå¤ï¼šç”¨æˆ·æä¾›ç²¾å‡†çš„æ ¹å› åˆ†æ
- ä¿®å¤å®æ–½ï¼šAI åŠ©æ‰‹

## ä¿®å¤æ—¥æœŸ
2026å¹´2æœˆ4æ—¥
